from flask import Flask, render_template, jsonify, request
import random

app = Flask(__name__)

# Mock user data for testing
user_data = {
    "user_id": 12345,
    "neon_coins": 1000,
    "username": "TestPlayer"
}

@app.route('/')
def index():
    return render_template('index.html', user=user_data)

@app.route('/api/spin_slots', methods=['POST'])
def spin_slots():
    bet = request.json.get('bet', 10)
    if user_data['neon_coins'] < bet:
        return jsonify({"error": "Not enough NeonCoins"}), 400
    
    # Slot machine logic: 3 reels, each with 3 possible outcomes
    reels = [random.choice(['🍒', '💎', '7️⃣']) for _ in range(3)]
    user_data['neon_coins'] -= bet
    
    # Win conditions
    if reels[0] == reels[1] == reels[2]:
        multiplier = 10 if reels[0] == '7️⃣' else 5
        winnings = bet * multiplier
        user_data['neon_coins'] += winnings
        return jsonify({"reels": reels, "neon_coins": user_data['neon_coins'], "winnings": winnings})
    
    return jsonify({"reels": reels, "neon_coins": user_data['neon_coins'], "winnings": 0})

@app.route('/api/roll_dice', methods=['POST'])
def roll_dice():
    bet = request.json.get('bet', 10)
    prediction = request.json.get('prediction', 7)  # Sum of two dice
    if user_data['neon_coins'] < bet:
        return jsonify({"error": "Not enough NeonCoins"}), 400
    
    # Roll two dice
    dice = [random.randint(1, 6), random.randint(1, 6)]
    total = sum(dice)
    user_data['neon_coins'] -= bet
    
    # Win if predicted sum matches
    if total == prediction:
        winnings = bet * 5
        user_data['neon_coins'] += winnings
        return jsonify({"dice": dice, "total": total, "neon_coins": user_data['neon_coins'], "winnings": winnings})
    
    return jsonify({"dice": dice, "total": total, "neon_coins": user_data['neon_coins'], "winnings": 0})

@app.route('/api/user')
def get_user():
    return jsonify(user_data)

if __name__ == '__main__':
    app.run(debug=True)